### 添加水印的工具类：

waterMark:

```javascript
/**  水印添加方法  */
//str 水印文字
let setWatermark = (str) => {
  let id = 'watermark_box'

  if (document.getElementById(id) !== null) {
    document.body.removeChild(document.getElementById(id))
  }

  let can = document.createElement('canvas')
  // 设置canvas画布大小
  can.width = 250
  can.height = 150

  let cans = can.getContext('2d')
  cans.rotate(-20 * Math.PI / 180) // 水印旋转角度
  cans.font = '18px 微软雅黑'
  cans.fillStyle = '#666'
  cans.textAlign = 'center'
  cans.textBaseline = 'Middle'
  //fillText("要现实的文字",x,y)，这里面的x,y代表的是哪个点的坐标
  cans.fillText(str, can.width / 2, can.height, can.width) // 水印在画布的位置x，y轴

  let div = document.createElement('div')
  div.id = id
  //pointerEvents此CSS属性设置为“none”时，元素不接收悬停/单击事件，而事件将发生在其后面的任何内容上。
  div.style.pointerEvents = 'none'
  div.style.top = '60px'
  div.style.left = '50px'
  div.style.opacity = '0.1'
  div.style.position = 'fixed'
  div.style.zIndex = '100000'
  div.style.width = document.documentElement.clientWidth + 'px'
  div.style.height = document.documentElement.clientHeight + 'px'
  div.style.background = 'url(' + can.toDataURL('image/png') + ') left top repeat'
  document.body.appendChild(div)
  return id
}

// 添加水印方法
export const setWaterMark = (str) => {
  let id = setWatermark(str)
  if (document.getElementById(id) === null) {
    id = setWatermark(str1)
  }
}

// 移除水印方法
export const removeWatermark = () => {
  let id = 'watermark_box'
  if (document.getElementById(id) !== null) {
    document.body.removeChild(document.getElementById(id))
  }
}

```

### 根据路由控制添加

permission.js

```javascript
import router from './router'
import store from './store'
import { Message } from 'element-ui'
import NProgress from 'nprogress'
import 'nprogress/nprogress.css'
import { getToken } from '@/utils/auth'
import { isRelogin } from '@/utils/request'
import { setWaterMark, removeWatermark } from "../src/utils/waterMark";
import { currentTime } from "../src/utils/commonFun";

NProgress.configure({ showSpinner: false })

const whiteList = ['/login', '/auth-redirect', '/bind', '/register']

router.beforeEach((to, from, next) => {
  NProgress.start()
  if (getToken()) {
    to.meta.title && store.dispatch('settings/setTitle', to.meta.title)
    /* has token*/
    if (to.path === '/login') {
      next({ path: '/' })
      NProgress.done()
    } else {
      if (store.getters.roles.length === 0) {
        isRelogin.show = true
        // 判断当前用户是否已拉取完user_info信息
        store.dispatch('GetInfo').then(() => {
          isRelogin.show = false
          store.dispatch('GenerateRoutes').then(accessRoutes => {
            // 根据roles权限生成可访问的路由表
            router.addRoutes(accessRoutes) // 动态添加可访问路由表
            next({ ...to, replace: true }) // hack方法 确保addRoutes已完成
          })
        }).catch(err => {
            store.dispatch('LogOut').then(() => {
              Message.error(err)
              next({ path: '/' })
            })
          })
      } else {
        next()
      }
    }
  } else {
    // 没有token
    if (whiteList.indexOf(to.path) !== -1) {
      // 在免登录白名单，直接进入
      next()
    } else {
      next(`/login?redirect=${to.fullPath}`) // 否则全部重定向到登录页
      NProgress.done()
    }
  }
})

router.afterEach((item) => {
  NProgress.done();
    
  //添加水印
  if (item.path !== '/login') {    //判断是否为登录页面，登录页面无水印
    const userName = router.app.$store.state.user.name;
    const name = router.app.$store.state.user.nickName;
    var time = currentTime();
    setWaterMark(userName + " " + name + " " + time);
  } else {
    //清除水印
    removeWatermark()
  }
})
```

